# AiTril Configuration Checkpoint - User Preferences

**Last Updated**: 2025-11-28
**Purpose**: Source of truth for AiTril configuration to prevent accidental downgrades or misconfigurations

---

## âš ï¸ CRITICAL: Latest 2025 LLM Models

**DO NOT DOWNGRADE THESE MODELS!** The user specifically wants the latest 2025 models:

### Primary LLM Providers

| Provider | Model ID | Released | Notes |
|----------|----------|----------|-------|
| OpenAI | `gpt-5.1` | Late 2025 | Latest GPT model |
| Anthropic | `claude-opus-4.5-20251124` | Nov 24, 2025 | Claude Opus 4.5 |
| Google Gemini | `gemini-3-pro-preview` | Nov 18, 2025 | Gemini 3 Pro Preview |
| Ollama | `granite4:350m` | - | Local model |

### Environment Variables (.env)

```bash
# OpenAI Configuration
OPENAI_API_KEY=[set]
OPENAI_MODEL=gpt-5.1

# Anthropic Configuration
ANTHROPIC_API_KEY=[set]
ANTHROPIC_MODEL=claude-opus-4.5-20251124

# Google Gemini Configuration
GOOGLE_API_KEY=AIzaSyBLHOqMtiVbvgH9mp1hILWSXobI6VBeT70
GEMINI_MODEL=gemini-3-pro-preview

# Ollama Configuration
OLLAMA_BASE_URL=http://localhost:11434
OLLAMA_MODEL=granite4:350m
```

---

## ğŸ¯ Initial Planner Configuration

The user wants an **initial planner agent** that runs first to set groundwork for other agents:

- **Initial Planner**: `openai` (GPT-5.1)
- **Workflow**: Planner creates initial design/plan â†’ Other agents improve and build on it
- **Display**: Planner shows first with ğŸ“‹ icon in UI

---

## ğŸŒ Web Server Configuration

### Port Settings
- **Port**: `37142` (not 8888 - conflicts with other apps)
- **Reason**: Port 37142 is in registered range (1024-49151) and unlikely to conflict

### Environment Loading
- **Critical**: Web server MUST load `.env` file at startup using `python-dotenv`
- **Location**: `aitril/web.py` lines 24-46
- **Verification**: Check startup logs for "âœ“ Loaded environment variables"

---

## ğŸ“ File Locations

### Configuration Files
```
~/.aitril/settings.json          # User settings (takes precedence)
.env                              # Environment variables (project root)
aitril/settings.py                # Default settings (fallback)
```

### Priority Order
1. `settings.json` model values
2. Environment variables from `.env`
3. Defaults in `settings.py`

**Important**: All three should be kept in sync!

---

## ğŸ—ï¸ Architecture Preferences

### Provider Support
- **Total Providers**: 8 (OpenAI, Anthropic, Gemini, Ollama, Llama.cpp, Custom1-3)
- **Enabled by Default**: OpenAI, Anthropic, Gemini, Ollama
- **Local Models**: Ollama (enabled), Llama.cpp (disabled)

### UI Features
- âš™ï¸ Settings button MUST be present in sidebar
- ğŸ“‹ Initial planner shows first in agent list
- All enabled providers show in agent panel
- Deployment options after build mode

---

## ğŸš« Common Mistakes to Avoid

### âŒ DO NOT:
1. Downgrade models to older versions (gpt-4o, claude-sonnet, gemini-1.5-pro)
2. Remove the settings button from UI
3. Change port back to 8888
4. Remove `.env` loading from web.py
5. Disable initial planner functionality
6. Set Gemini to `gemini-3-pro` instead of `gemini-3-pro-preview`

### âœ… DO:
1. Always verify model versions match this file
2. Check that settings.json, .env, and settings.py are synced
3. Test that all providers initialize (check logs for "Failed to initialize")
4. Ensure deployment selection works (sends WebSocket message)
5. Keep API keys in .env, never hardcode

---

## ğŸ” Validation Checklist

Before making changes to provider configuration:

- [ ] Check this file for correct model names
- [ ] Verify .env has correct GEMINI_MODEL (gemini-3-pro-preview)
- [ ] Verify .env has correct ANTHROPIC_MODEL (claude-opus-4.5-20251124)
- [ ] Verify .env has correct OPENAI_MODEL (gpt-5.1)
- [ ] Check settings.json matches .env values
- [ ] Check settings.py defaults match .env values
- [ ] Test that web server loads .env (check logs)
- [ ] Verify all 4 providers initialize successfully

---

## ğŸ“ Deployment Preferences

### Deployment Flow
1. Build mode completes â†’ Show deployment options
2. User selects deployment (or "Skip Deployment")
3. Frontend sends `deployment_selected` WebSocket message
4. Backend handles deployment and sends status messages
5. UI shows deployment progress and completion

### Required Event Handlers (app.js)
- `deployment_options` - Show deployment selector
- `deployment_started` - Show deployment initiation
- `status_message` - Display backend messages
- `deployment_completed` - Mark complete, re-enable send button

---

## ğŸ”§ Quick Reference Commands

### Verify Configuration
```bash
# Check .env settings
grep -E "^(OPENAI|ANTHROPIC|GEMINI)_MODEL=" .env

# Check settings.json
cat ~/.aitril/settings.json | jq '.llm_providers | to_entries | .[] | select(.value.enabled == true) | {key: .key, model: .value.model}'

# Test provider initialization
python3 /tmp/test_provider_init.py
```

### Restart Web Server
```bash
# Kill existing server
pkill -f "uvicorn.*web:app"

# Start with .env loading and auto-reload
python3 -m uvicorn aitril.web:app --host 0.0.0.0 --port 37142 --reload
```

---

## ğŸ“š Model Version History

### Why These Specific Models?

**User explicitly requested these in conversation:**
- Web search confirmed GPT-5.1 released late 2025
- Web search confirmed Claude Opus 4.5 released Nov 24, 2025
- Web search confirmed Gemini 3 Pro released Nov 18, 2025

**Previous downgrades that were WRONG:**
- âŒ gemini-1.5-pro â†’ Should be gemini-3-pro-preview
- âŒ claude-sonnet-4-5-20250929 â†’ Should be claude-opus-4.5-20251124
- âŒ gpt-4o â†’ Should be gpt-5.1

---

## ğŸ¨ UI Conventions

### Mode Names & Icons
- **Build** (ğŸ—ï¸): Multi-phase with initial planner â†’ planning â†’ implementation â†’ deployment
- **Tri-lam** (ğŸ§¬): Parallel agents with optional initial planner
- **Consensus** (ğŸ¤): Agents debate to reach agreement
- **Ask** (ğŸ’¬): Single provider query

### Agent Display
- Planner agent: `ğŸ“‹ Planner (OpenAI)` with isPlanner flag
- Regular agents: Provider name with model badge
- Local models: Show "LOCAL" badge

---

## ğŸ’¾ Backup Original Settings

If needed, restore from this checkpoint by:
1. Updating `~/.aitril/settings.json` with model values above
2. Updating `.env` with environment variables above
3. Updating `aitril/settings.py` defaults to match
4. Restarting web server to reload configuration

**Created**: 2025-11-28 by Claude Code
**Validated**: User confirmed all settings correct
